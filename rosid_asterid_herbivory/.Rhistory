#Abundance of herbivory
#Continuous, garbage
Fig3_cont <- ggplot(topfive_RA_dframe_resh, aes(x=doy, y=value, colour=plant_genus_species))
Fig3_cont <- Fig3_cont +  geom_point() +ylim(0,5) +theme_bw() +xlab("day of year") + ylab("cells with herbivore damage")
Fig3_cont
#Get incidence of chewing herbivory for all species
#Plot how chewing herbivory changes over season for all species
levels(RA_dframe$plant_genus_species)
BATI <- subset(RA_dframe, plant_genus_species == "baptisia_tinctoria")
CLAL <- subset(RA_dframe, plant_genus_species == "clethra_alnifolia")
CORA <- subset(RA_dframe, plant_genus_species == "cornus_racemosa")
EPRE <- subset(RA_dframe, plant_genus_species == "epigaea_repens")
GATR <- subset(RA_dframe, plant_genus_species == "galium_triflorum")
GABA <- subset(RA_dframe, plant_genus_species == "gaylussacia_baccata")
KAAN <- subset(RA_dframe, plant_genus_species == "kalmia_angustifolia")
LEIN <- subset(RA_dframe, plant_genus_species == "lechea_intermedia")
LECA <- subset(RA_dframe, plant_genus_species == "lespedeza_capitata")
LEHI <- subset(RA_dframe, plant_genus_species == "lespedeza_hirta")
LUPA <- subset(RA_dframe, plant_genus_species == "ludwigia_palustris")
LYAM <- subset(RA_dframe, plant_genus_species == "lycopus_americanus")
LYTE <- subset(RA_dframe, plant_genus_species == "lysimachia_terrestris")
MEAR <- subset(RA_dframe, plant_genus_species == "mentha_arvensis")
POSA <- subset(RA_dframe, plant_genus_species == "polygala_sanguinea")
TRVI <- subset(RA_dframe, plant_genus_species == "triadenum_virginicum")
VAMA <- subset(RA_dframe, plant_genus_species == "vaccinium_macrocarpon")
VIBL <- subset(RA_dframe, plant_genus_species == "viola_blanda")
VICU <- subset(RA_dframe, plant_genus_species == "viola_cucullata")
VILA <- subset(RA_dframe, plant_genus_species == "vitis_labrusca")
#Plots of chewing abundance by doy by species
plo <- ggplot(BATI, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(CLAL, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(CORA, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(EPRE, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(GATR, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(GABA, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(KAAN, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(LEIN, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(LECA, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(LEHI, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(LUPA, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(LYAM, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(LYTE, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(MEAR, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(POSA, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(TRVI, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(VAMA, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(VIBL, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(VICU, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
plo <- ggplot(VILA, aes(x=doy, y=ch_leafremoved, colour=plant_genus_species)) + geom_point() + geom_abline()
plo
#Identify species with most chewing damage
mean_damage_abund <- ddply(RA_dframe, ~plant_genus_species, summarize, mean_chewing = mean(ch_leafremoved, na.rm=T))
#Sort and choose top 5, see if this is a good method for displaying data
#Do this for other types of damage, too?
attach(mean_damage_abund)
mean_damage_abund_top <- mean_damage_abund[order(mean_chewing),]
#Cat
#Format data
RA_dframe$totalherbiv <- RA_dframe$chewing_tot+RA_dframe$stippling+RA_dframe$leafmines_tot+RA_dframe$sooty.mould+RA_dframe$leaf.galls
RA_dframe$binary_noherbiv <- ifelse(RA_dframe$totalherbiv>0, 1, 0)
RA_dframe$binary_chew<- ifelse(RA_dframe$ch_leafremoved>0, 1, 0)
RA_dframe$binary_skel <- ifelse(RA_dframe$skel>0, 1, 0)
RA_dframe$binary_stipp <- ifelse(RA_dframe$stippling>0, 1, 0)
RA_dframe$binary_lmines <- ifelse(RA_dframe$leafmines_tot>0, 1, 0)
RA_dframe$binary_SM <- ifelse(RA_dframe$sooty.mould>0, 1, 0)
RA_dframe$binary_lgalls <- ifelse(RA_dframe$leaf.galls>0, 1, 0)
RA_dframe$binary_blotchmines <- ifelse(RA_dframe$blotch.mine>0, 1, 0)
RA_dframe$binary_serpmines <- ifelse(RA_dframe$serpentine.mine>0, 1, 0)
RA_dframe_resh2 <- melt(RA_dframe, id.vars=c("plant_genus_species", "taxon", "MF", "abscission_num",
"herbarium", "date", "month", "month_cat", "day", "year", "doy",
"state", "phenology", "county", "X1", "X2"))
RA_dframe_resh2_fig2 <- subset(RA_dframe_resh2, variable== "binary_noherbiv"|variable=="binary_chew"|variable=="binary_stipp"|variable=="binary_lmines"|
variable=="binary_SM"|variable=="binary_lgalls"|variable=="binary_skel")
mar <- subset(RA_dframe_resh2_fig2, month_cat=="March")
apr <- subset(RA_dframe_resh2_fig2, month_cat=="April")
may <- subset(RA_dframe_resh2_fig2, month_cat=="May")
jun <- subset(RA_dframe_resh2_fig2, month_cat=="June")
jul <- subset(RA_dframe_resh2_fig2, month_cat=="July")
aug <- subset(RA_dframe_resh2_fig2, month_cat=="August")
sept <- subset(RA_dframe_resh2_fig2, month_cat=="September")
oct <- subset(RA_dframe_resh2_fig2, month_cat=="October")
#Plot
cat <- ggplot(RA_dframe_resh2_fig2, aes(value))
cat <- cat + geom_bar(aes(fill = variable), position = "fill")
cat
RA_dframe_resh2_fig2$value <- as.numeric(RA_dframe_resh2_fig2$value)
x <- nrow(RA_dframe_resh2_fig2)
RA_dframe_fig2_noNA <- subset(RA_dframe_resh2_fig2, value != "NA")
RA_dframe_fig2_noNA$prop <- RA_dframe_fig2_noNA$value/4908
RA_dframe_fig2_noNA <- subset(RA_dframe_fig2_noNA, month_cat != "March" & month_cat != "December" & variable != "binary_SM")
cbPalette <- c("binary_noherbiv"= "#009E73", "binary_chew"="#E69F00", "binary_skel"="#56B4E9", "binary_stipp"= "#0072B2", "binary_lgalls" = "#F0E442", "binary_lmines" = "#000000")
cat <- ggplot(RA_dframe_fig2_noNA, aes(x=reorder(month_cat,doy), y=prop)) + theme_bw() + xlab("") + ylab("Proportion of specimens")
cat <- cat + geom_bar(aes(fill = variable), position = "fill", stat="identity") + scale_fill_manual(values=cbPalette,
name="Damage Type",
breaks=c("binary_chew", "binary_skel", "binary_stipp", "binary_lgalls", "binary_lmines", "binary_noherbiv"),
labels=c("chewing (leaf area removed)", "skeletonization", "stippling", "leaf galls", "leaf mines", "no herbivory"))
cat
#x=reorder(plant_genus_species,ch_leafremoved, mean)
#Overall test for effect of year, doy
RA_dframe_noNAchew <- subset(RA_dframe, ch_leafremoved != "NA")
RA_dframe_noNAchew$totalboxes <- 5
RA_dframe_noNAchew$chew_prop <- RA_dframe_noNAchew$ch_leafremoved/RA_dframe_noNAchew$totalboxes
model <- glmer(chew_prop~log(doy+1)+(1|plant_genus_species), weights=totalboxes, family = binomial(logit),
na.action=na.omit, data=RA_dframe_noNAchew, control = glmerControl(optimizer = "bobyqa"),
nAGQ = 10)
summary(model)
binary_chew <- list()
binary_chew[[1]] <- glm(chew_prop~doy*plant_genus_species+year, weights=totalboxes, family = binomial(logit),
na.action=na.omit, data=RA_dframe_noNAchew)
binary_chew[[2]] <- glm(chew_prop~doy*plant_genus_species, weights=totalboxes, family = binomial(logit),
na.action=na.omit, data=RA_dframe_noNAchew)
binary_chew[[3]] <- glm(chew_prop~doy, weights=totalboxes, family = binomial(logit),
na.action=na.omit, data=RA_dframe_noNAchew)
binary_chew[[4]] <- glm(chew_prop~plant_genus_species, weights=totalboxes, family = binomial(logit),
na.action=na.omit, data=RA_dframe_noNAchew)
binary_chew[[5]] <- glm(chew_prop~1, weights=totalboxes, family = binomial(logit),
na.action=na.omit, data=RA_dframe_noNAchew)
Modnames <- c("year_doy_species", "species_doy", "doy", "species", "null")
(aict <- aictab(cand.set = binary_chew, modnames=Modnames, sort=TRUE))
anova(binary_chew[[2]], binary_chew[[5]], test="LRT")
summary(binary_chew[[2]])
#Separate GLM models for each spp? to see how many are significant?
#Figure 4: NMDS
#Just Viola and Lespedeza for paper figure
#Construct matrix
RA_dframe_sub <- RA_dframe
attach(RA_dframe_sub)
RA_dframe_sub$Total <- ch_leafremoved+skel+stippling+blotch.mine+serpentine.mine+leafminer.oviholes+leaf.galls+leaf.roller
RA_dframe_sub <- subset(RA_dframe_sub, Total != "NA" & Total != 0)
RA_dframe_sub_justfour <- subset(RA_dframe_sub, plant_genus_species == "viola_blanda"|plant_genus_species == "viola_cucullata"|
plant_genus_species == "lespedeza_hirta"|plant_genus_species == "lespedeza_capitata")
RA_dframe_sub_justfour$plant_genus_species <- factor(RA_dframe_sub_justfour$plant_genus_species)
#Get rid of outlier with 4 leaf galls
RA_dframe_sub_justfour <- subset(RA_dframe_sub_justfour, leaf.galls<4)
mat <- RA_dframe_sub_justfour[,15:25]
matID <- 1:nrow(mat)
mat <- cbind(mat, matID)
RA_dframe_sub_justfour <- cbind(matID, RA_dframe_sub_justfour)
mat <- mat[c("ch_leafremoved", "skel",    "stippling", "blotch.mine", "serpentine.mine",
"leafminer.oviholes", "leaf.galls")]
mat <- as.matrix(mat)
#Make map
map <- RA_dframe_sub_justfour[c("matID", "plant_genus_species", "taxon", "MF", "abscission_num", "herbarium",
"date", "month", "month_cat", "day", "year", "doy", "state", "phenology", "county" )]
#nmds
otu.bray <- vegdist(mat,method="bray")
braycurtis.mds <- metaMDS(otu.bray, k=2)
#base plot
with(map, levels(plant_genus_species))
stressplot(braycurtis.mds)
colvec <- c("black","darkgrey","red","orange")
plot(braycurtis.mds)
with(map, points(braycurtis.mds, display="sites", col=colvec[plant_genus_species], pch=21, bg=colvec[plant_genus_species]))
with(map, legend("topright",legend=levels(plant_genus_species),bty="n", col=colvec, pch=21, pt.bg=colvec))
#plot with hulls
braycurtis.mds_ord <- braycurtis.mds$points
braycurtis.mds_ord <- braycurtis.mds_ord[1:101,]
joined_ord_map <- merge(braycurtis.mds_ord, map, by= "row.names")
head(joined_ord_map)
rownames(joined_ord_map) <- joined_ord_map[,1]
joined_ord_map <- joined_ord_map[,-1]
names(joined_ord_map)
#Create data for convex hulls
data.scores <- as.data.frame(scores(braycurtis.mds_ord))
data.scores$site <- rownames(data.scores)
data.scores$grp <- joined_ord_map$plant_genus_species
grp.vc <- data.scores[data.scores$grp == "viola_cucullata", ][chull(data.scores[data.scores$grp ==
"viola_cucullata", c("MDS1", "MDS2")]), ]  # hull values for grp A
grp.vb <- data.scores[data.scores$grp == "viola_blanda", ][chull(data.scores[data.scores$grp ==
"viola_blanda", c("MDS1", "MDS2")]), ]  # hull values for grp B
grp.lh <- data.scores[data.scores$grp == "lespedeza_hirta", ][chull(data.scores[data.scores$grp ==
"lespedeza_hirta", c("MDS1", "MDS2")]), ]  # hull values for grp A
grp.lc <- data.scores[data.scores$grp == "lespedeza_capitata", ][chull(data.scores[data.scores$grp ==
"lespedeza_capitata", c("MDS1", "MDS2")]), ]  # hull values for grp A
hull.data <- rbind(grp.vc, grp.vb, grp.lh, grp.lc)  #combine grp.a and grp.b
hull.data
#Species vectors
vectors_species <- envfit(braycurtis.mds, map, perm=999, na.rm=TRUE)
#spp.scrs <- as.data.frame(scores(vectors_species, display = "vectors"))
#spp.scrs <- cbind(spp.scrs, Species = rownames(spp.scrs))
A <- as.list(vectors_species$vectors)
#creating the dataframe
pvals <-as.data.frame(A$pvals)
arrows <-as.data.frame(A$arrows*sqrt(A$r))
C <-cbind(arrows, pvals)
#subset
Cred_sp<-subset(C, pvals<0.05)
Cred_sp <- cbind(Cred_sp, Species = rownames(Cred_sp))
colvec <- c("black","darkgrey","red","orange")
ggplot() +
#geom_polygon(data=hull.data,aes(x=MDS1,y=MDS2,fill=grp,group=grp),alpha=0.30, show.legend=FALSE) + # add the convex hulls
scale_fill_manual(values=c("lespedeza_capitata" = "black", "lespedeza_hirta" = "darkgrey", "viola_blanda" = "red", "viola_cucullata"="orange")) +
geom_point(data=data.scores,aes(x=MDS1,y=MDS2, colour=grp),size=3) + # add the point markers
scale_colour_manual(values=c("lespedeza_capitata" = "black", "lespedeza_hirta" = "darkgrey", "viola_blanda" = "red", "viola_cucullata"="orange"), name="") +
coord_equal() +
theme_bw() +
theme(axis.text.x = element_blank(),  # remove x-axis text
axis.text.y = element_blank(), # remove y-axis text
axis.ticks = element_blank(),  # remove axis ticks
axis.title.x = element_text(size=12), # remove x-axis labels
axis.title.y = element_text(size=12), # remove y-axis labels
panel.background = element_blank(),
panel.grid.major = element_blank(),  #remove major-grid labels
panel.grid.minor = element_blank(),  #remove minor-grid labels
plot.background = element_blank()) +
theme(legend.title = element_text(size=10)) +
theme(legend.text = element_text(size =10))
#+
#scale_shape_manual(values = c(17, 2), name="Spray treatment", breaks=c("n", "y"), labels=c("not sprayed", "sprayed"))
#ggsave(file="/Users/emilymeineke/Desktop/Collaborations/Annas project/Annas data 10.13.2015/Analyses for ESA/Figures/Spiderbraycurtis.mds2013_withspecies.tiff", width=18, height=18, units="cm", dpi=300)
#All species
#Construct matrix
RA_dframe_sub <- RA_dframe
attach(RA_dframe_sub)
RA_dframe_sub$Total <- ch_leafremoved+skel+stippling+blotch.mine+serpentine.mine+leafminer.oviholes+leaf.galls+leaf.roller
RA_dframe_sub <- subset(RA_dframe_sub, Total != "NA" & Total != 0)
#Get rid of outlier with 4 leaf galls
RA_dframe_sub <- subset(RA_dframe_sub, leaf.galls<4)
mat <- RA_dframe_sub[,15:25]
matID <- 1:nrow(mat)
mat <- cbind(mat, matID)
RA_dframe_sub <- cbind(matID, RA_dframe_sub)
mat <- mat[c("ch_leafremoved", "skel",    "stippling", "blotch.mine", "serpentine.mine",
"leafminer.oviholes", "leaf.galls")]
mat <- as.matrix(mat)
#Make map
map <- RA_dframe_sub[c("matID", "plant_genus_species", "taxon", "MF", "abscission_num", "herbarium",
"date", "month", "month_cat", "day", "year", "doy", "state", "phenology", "county" )]
#nmds
otu.bray <- vegdist(mat,method="bray")
braycurtis.mds <- metaMDS(otu.bray, k=2)
#base plot
with(map, levels(plant_genus_species))
stressplot(braycurtis.mds)
colvec <- c("black","lawngreen","navy","grey", "yellow", "darkblue","green","purple","orange",
"red1", "darkgreen","skyblue", "darkturquoise", "brown","darkslategrey", "springgreen1","cadetblue4",
"chocolate4", "palegoldenrod", "violetred2")
plot(braycurtis.mds)
with(map, points(braycurtis.mds, display="sites", col=colvec[plant_genus_species], pch=21, bg=colvec[plant_genus_species]))
with(map, legend("topright",legend=levels(plant_genus_species),bty="n", col=colvec, pch=21, pt.bg=colvec))
#Hypothesis testing
fotu.bray <- vegdist(mat,method="bray")
fad<-adonis(fotu.bray~plant_genus_species, data=map, permutations=999)
fad
fmod<-with(map,betadisper(fotu.bray,plant_genus_species))
anova(fmod)
TukeyHSD(fmod)
#Calculate total damage types per specimen
RA_dframe$total_damtypes <- RA_dframe$binary_chew + RA_dframe$binary_skel + binary_stipp + binary_lmines + binary_SM + binary_lgalls + binary_blotchmines + binary_serpmines
RA_dframe$damdiv_prop <- RA_dframe$total_damtypes/8
RA_dframe$Total_types <- 8
mean_damage <- ddply(RA_dframe, ~plant_genus_species, summarize, mean_damtypes = mean(total_damtypes, na.rm=T))
mean_damage_abv1 <- subset(mean_damage, mean_damtypes >1)
mean_damage
write.csv(mean_damage, file="meandamagetypesperspecies.csv")
mean_div <- read.csv("meandamagetypeperspecies.csv", header=TRUE)
mean_div <- read.csv("meandamagetypesperspecies.csv", header=TRUE)
View(mean_div)
sp.herbivory
sp.herbivory<-aggregate(damage~plant_genus_species, data = my.data, FUN = "mean")
sp.herbivory
mean_div
mean_div <- mean_div[,-1]
mean_div
sp.div <- read.csv("meandamagetypesperspecies.csv", header=TRUE)
sp.div <- sp.div[,-1]
row.names(sp.div)<-sp.div[,1]
div.dat<-sp.div[,2]
names(div.dat)<-row.names(sp.div)
div.dat
phy.signal.data<-match.phylo.data(tree, div.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
RA_dframe_sub <- RA_dframe
attach(RA_dframe_sub)
RA_dframe_sub$Total <- ch_leafremoved+skel+stippling+blotch.mine+serpentine.mine+leafminer.oviholes+leaf.galls+leaf.roller
RA_dframe_sub <- subset(RA_dframe_sub, Total != "NA" & Total != 0)
#Get rid of outlier with 4 leaf galls
RA_dframe_sub <- subset(RA_dframe_sub, leaf.galls<4)
mat <- RA_dframe_sub[,15:25]
matID <- 1:nrow(mat)
mat <- cbind(mat, matID)
RA_dframe_sub <- cbind(matID, RA_dframe_sub)
mat <- mat[c("ch_leafremoved", "skel",    "stippling", "blotch.mine", "serpentine.mine",
"leafminer.oviholes", "leaf.galls")]
mat <- as.matrix(mat)
#Make map
map <- RA_dframe_sub[c("matID", "plant_genus_species", "taxon", "MF", "abscission_num", "herbarium",
"date", "month", "month_cat", "day", "year", "doy", "state", "phenology", "county" )]
#nmds
otu.bray <- vegdist(mat,method="bray")
braycurtis.mds <- metaMDS(otu.bray, k=2)
#base plot
with(map, levels(plant_genus_species))
stressplot(braycurtis.mds)
colvec <- c("black","lawngreen","navy","grey", "yellow", "darkblue","green","purple","orange",
"red1", "darkgreen","skyblue", "darkturquoise", "brown","darkslategrey", "springgreen1","cadetblue4",
"chocolate4", "palegoldenrod", "violetred2")
plot(braycurtis.mds)
with(map, points(braycurtis.mds, display="sites", col=colvec[plant_genus_species], pch=21, bg=colvec[plant_genus_species]))
with(map, legend("topright",legend=levels(plant_genus_species),bty="n", col=colvec, pch=21, pt.bg=colvec))
#Hypothesis testing
fotu.bray <- vegdist(mat,method="bray")
fad<-adonis(fotu.bray~plant_genus_species, data=map, permutations=999)
fad
fmod<-with(map,betadisper(fotu.bray,plant_genus_species))
anova(fmod)
TukeyHSD(fmod)
braycurtis.mds_ord <- braycurtis.mds$points
braycurtis.mds_ord
dim(braycurtis.mds_ord)
braycurtis.mds_ord <- braycurtis.mds_ord[1:527,]
braycurtis.mds_ord
joined_ord_map <- merge(braycurtis.mds_ord, map, by= "row.names")
head(joined_ord_map)
View(joined_ord_map)
rownames(joined_ord_map) <- joined_ord_map[,1]
joined_ord_map <- joined_ord_map[,-1]
names(joined_ord_map)
mean_ordscore <- ddply(joined_ord_map, ~plant_genus_species, summarize, mean_mds = mean(MDS1, na.rm=T))
mean_ordscore
write.csv(mean_ordscore, file="meanordscore.csv")
meanordscore <- read.csv("meanordscore.csv", header=TRUE)
head(meanordscore)
sp.ord <- read.csv("meanordscore.csv", header=TRUE)
head(sp.ord)
sp.ord <- sp.ord[,-1]
sp.ord
row.names(sp.ord)<-sp.ord[,1]
ord.dat<-sp.ord[,2]
names(ord.dat)<-row.names(sp.ord)
ord.dat
phy.signal.data<-match.phylo.data(tree, ord.dat)
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
##suggest no signifiicant phylo signal
#and just for fun, let's map herbivory on to the phylogeny:
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#########################################
#this is where I generate  summary dataframe for herbivory damage
#any damage:
damage <-NULL
for (x in 1:length(data[,1])){
damage[x]<-sum(data[x,c(14:26)], na.rm = T)
}
my.data<-cbind(data, damage)
#summarise herbivory damage by species
sp.herbivory<-aggregate(damage~plant_genus_species, data = my.data, FUN = "mean")
sp.chewing<-aggregate(ch_leafremoved~plant_genus_species, data = my.data, FUN = "mean")
sp.bmines<-aggregate(blotch.mine~plant_genus_species, data = my.data, FUN = "mean")
sp.serpmines<-aggregate(serpentine.mine~plant_genus_species, data = my.data, FUN = "mean")
sp.skel<-aggregate(skel~plant_genus_species, data = my.data, FUN = "mean")
sp.lgalls<-aggregate(leaf.galls~plant_genus_species, data = my.data, FUN = "mean")
sp.SM<-aggregate(sooty.mould~plant_genus_species, data = my.data, FUN = "mean")
row.names(sp.herbivory)<-sp.herbivory[,1]
row.names(sp.chewing)<-sp.chewing[,1]
row.names(sp.bmines)<-sp.bmines[,1]
row.names(sp.serpmines)<-sp.serpmines[,1]
row.names(sp.skel)<-sp.skel[,1]
row.names(sp.lgalls)<-sp.lgalls[,1]
row.names(sp.SM)<-sp.SM[,1]
#Overall herbivory- Jonathan's test
herbivory.dat<-sp.herbivory[,2]
names(herbivory.dat)<-row.names(sp.herbivory)
phy.signal.data<-match.phylo.data(tree, herbivory.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
#          K PIC.variance.obs PIC.variance.rnd.mean PIC.variance.P PIC.variance.Z
#1 0.2219002        0.0746682             0.0972578          0.452     -0.3963395
##suggest no signifiicant phylo signal in herbivory
#and just for fun, let's map herbivory on to the phylogeny:
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#Chewing damage
chewing.dat<-sp.chewing[,2]
names(chewing.dat)<-row.names(sp.chewing)
phy.signal.data<-match.phylo.data(tree, chewing.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
# K PIC.variance.obs PIC.variance.rnd.mean PIC.variance.P PIC.variance.Z
# 1 0.3965634       0.01561714            0.03275709          0.119       -1.14018
##
#map
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
chewing.dat
#Chewing damage
chewing.dat<-sp.chewing[,2]
names(chewing.dat)<-row.names(sp.chewing)
phy.signal.data<-match.phylo.data(tree, chewing.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
# K PIC.variance.obs PIC.variance.rnd.mean PIC.variance.P PIC.variance.Z
# 1 0.396563
#map
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#Blotch mines
bmines.dat<-sp.bmines[,2]
names(bmines.dat)<-row.names(sp.bmines)
phy.signal.data<-match.phylo.data(tree, bmines.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
#   K PIC.variance.obs PIC.variance.rnd.mean PIC.variance.P PIC.variance.Z
# 1 0.5119857     0.0005162566           0.001318864          0.268     -0.8899112
##
#map
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#Serpentine mines
serpmines.dat<-sp.serpmines[,2]
names(serpmines.dat)<-row.names(sp.serpmines)
phy.signal.data<-match.phylo.data(tree, serpmines.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
#          K PIC.variance.obs PIC.variance.rnd.mean PIC.variance.P PIC.variance.Z
#1 1.07898     1.122842e-06          6.128488e-06         0.2135     -0.8276614
##
#map
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#Skeletonization
skel.dat<-sp.skel[,2]
names(skel.dat)<-row.names(sp.skel)
phy.signal.data<-match.phylo.data(tree, skel.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
#          K PIC.variance.obs PIC.variance.rnd.mean PIC.variance.P PIC.variance.Z
#1 0.2219002        0.0746682             0.0972578          0.452     -0.3963395
##
#map
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#Leaf galls
lgalls.dat<-sp.lgalls[,2]
names(lgalls.dat)<-row.names(sp.lgalls)
phy.signal.data<-match.phylo.data(tree, lgalls.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
#          K PIC.variance.obs PIC.variance.rnd.mean PIC.variance.P PIC.variance.Z
#1 0.06808228     0.0006281368          0.0002252308         0.9965       2.471692
##
#map
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#Sooty mould
SM.dat<-sp.SM[,2]
names(SM.dat)<-row.names(sp.SM)
phy.signal.data<-match.phylo.data(tree, SM.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
#map
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#Damage diversity
sp.div <- read.csv("meandamagetypesperspecies.csv", header=TRUE)
sp.div <- sp.div[,-1]
row.names(sp.div)<-sp.div[,1]
div.dat<-sp.div[,2]
names(div.dat)<-row.names(sp.div)
phy.signal.data<-match.phylo.data(tree, div.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
#and just for fun, let's map herbivory on to the phylogeny:
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
#Damage composition
sp.ord <- read.csv("meanordscore.csv", header=TRUE)
head(sp.ord)
sp.ord <- sp.ord[,-1]
row.names(sp.ord)<-sp.ord[,1]
ord.dat<-sp.ord[,2]
names(ord.dat)<-row.names(sp.ord)
phy.signal.data<-match.phylo.data(tree, ord.dat)
#test for phylo signal
library(picante)
phylosignal(phy.signal.data$data, phy.signal.data$phy, reps = 999)
#and just for fun, let's map herbivory on to the phylogeny:
library(phytools)
contMap(phy.signal.data$phy, phy.signal.data$data)
